.. _structure:

Structure
============

.. _projectScenes:

Project Scenes
----------------

#. **Demo** : the main optimized :ref:`demo scene <demo>` of the project (read more about scene structure :ref:`here <sceneStructure>`).
#. **Demo Mono** : the new demo scene of the project, which contains an example of traffic & NPCs fully interacting with monobehaviour scripts (v1.1.0+).
#. **Demo source** : same as `Demo` scene, but contains raw 3D models without optimization, also scene :ref:`streaming objects <sceneStreaming>` are disabled, including :ref:`static physics colliders <physicsShapeTransfer>`.
#. **RuntimeTile Road Demo** : :ref:`sample scene <runtimeTileDemo>` showing how to create a city builder based on tiles (runtime spline can be used with `Road Constructor <https://assetstore.unity.com/packages/tools/level-design/road-constructor-287445>`_ plugin). **(new)**
#. **RuntimeTile Road Mobile Demo** : :ref:`sample scene <runtimeTileDemo>` showing how to create a city builder based on tiles *[mobile version]*. **(new)**
#. **Runtime ChunkRoad Demo** : :ref:`sample scene <chunkRoadDemo>` demonstrating the road chunks added at runtime. **(new)**
#. **Runtime CustomRoad Demo** : :ref:`sample scene <customRoadDemo>` to demonstrate the use of the `API` to generate run-time roads from `Unity` spline roads or from custom data. **(new)**
#. **Custom Train Demo** : an example of how a 3rd party train solution can be integrated. **(new)**
#. **Traffic test scene** : :ref:`traffic test scene <trafficTestScene>` where all parameters can be tested with a set of most :ref:`traffic <trafficCar>` situations.
#. **Pedestrian test scene** : :ref:`pedestrian test scene <pedestrianTestScene>` where the workability of entities can be tested.
#. **Props test scene** : :ref:`props test scene <propsTestScene>` where the workability of entities can be tested.
#. **City stress scene** : stress scene that combines thousands of :ref:`vehicles <trafficCar>` and :ref:`pedestrians <pedestrian>`.
#. **City stress scene mobile** : mobile version of `City stress scene`.
#. **Traffic stress scene** : stressed scene is extremely crowded with :ref:`vehicles <trafficCar>`.
#. **Traffic stress scene mobile** : mobile version of `Traffic stress scene`.
#. **Pedestrian stress scene** : stressed scene is extremely crowded with :ref:`pedestrians <pedestrian>`.
#. **Pedestrian stress scene mobile** : mobile version of `Pedestrian stress scene`.
#. **Pedestrian animation stress scene** : performance scene comparison between :ref:`Unity Animator <pedestrianHybridLegacy>` animations and :ref:`GPU animations <pedestrianGPU>`.
#. **Vehicle physics stress scene** : stress scene for the thousands cars with :ref:`Custom vehicle controller <customPhysicsVehicle>`.
#. **Vehicle custom physics test scene** : scene for testing various parameters of the :ref:`Custom vehicle controller <customPhysicsVehicle>`.

.. _sceneStructure:

Scene Hierarchy
----------------

	.. image:: /images/road/sceneStructure.png
	
.. _mainScene:
	
#. **Main scene**.
#. **City debugger** : contains all the :ref:`debuggers <subsceneGenerator>` for the city.

	.. _hub:

#. **Hub** : contains the :ref:`Entity Subscene Generator <subsceneGenerator>` (:ref:`read more <cityCreation>` on how to create it).
#. **City Settings Initializer** : contains the :ref:`General Settings <generalSettingsConfig>` of the `DOTS` city [moved to the `Config` tab].
#. **Main scene configs** (read more about the :ref:`config editing <configEdit>` workflow).
#. **Pools** : contains all the entity presets.
#. **Spawnpoint** : spawnpoint of the player (assigned in the `PlayerSpawner` if built-in solution in use).

	.. _subscene:

#. **Subscene** (`EntitySubScene`) : subscene into which all of the entities are converted (generated by the :ref:`Entity Subscene Generator <subsceneGenerator>`).
#. **Subscene configs** (read more about the :ref:`config editing <configEdit>` workflow).
#. **EntityRoadRoot** : object root generated by the :ref:`Entity Subscene Generator <subsceneGenerator>`.
#. **Road** : :ref:`road parent <roadParentInfo>` (read more about the :ref:`road editing <roadEdit>` workflow).

Scene Components
----------------

.. _roadParentInfo:
	
Road Parent
~~~~~~~~~~~~

The root of all crossroads in the scene.

	.. image:: /images/road/installation/RoadParent.png

How To Use
""""""""""""""

You read more :ref:`here <roadInstallation>`.

Settings
^^^^^^^^^^^^^^^^^^^^^^

| **Connection waypoint offset** : automatically adds a :ref:`waypoint <pathWaypointInfo>` at each selected offset to the :ref:`automatically <autoPathConnection>` created :ref:`paths <path>` (if the value is greater than zero).
| **Cast distance** : raycast connection distance between :ref:`Traffic nodes <trafficNode>`, if zero, then infinite value.
| **Multi angle raycast** : multi-angle raycasting along Z-axis.
| **Connect crosswalks** : auto-connect :ref:`Pedestrian node <pedestrianNode>` crosswalks

Utils
^^^^^^^^^^^^^^^^^^^^^^

| **Add crossroads** : adds scene crossroad if missing.
| **Connect pedestrian nodes** : automatically connects :ref:`pedestrian nodes <pedestrianNode>` that configured :ref:`auto-connection <pedestrianNodeConnections>`.
| **Clear unattached paths** : delete the :ref:`paths <path>` that are not connected to any a :ref:`TrafficNode <trafficNode>`.

Buttons
^^^^^^^^^^^^^^^^^^^^^^

| **Connect segments** : creates the :ref:`automatically generated paths <autoPathConnection>` for missing paths of :ref:`external <trafficNodeConnectionInfo>` nodes.
| **Force connect segments** : creates the :ref:`automatically generated paths <autoPathConnection>` for all paths of :ref:`external <trafficNodeConnectionInfo>` nodes (if a path was previously created & autopath lock is off for the :ref:`Traffic node <trafficNode>`, then the path will be overridden).
| **Bake path data** : :ref:`bake <bakingInfo>` road data. 

.. _subsceneGenerator:

Entity Subscene Generator
~~~~~~~~~~~~

	.. image:: /images/road/installation/HubInfo.png

Where To Find
""""""""""""""

#. Create :ref:`city base <cityCreation>` **[if missing, optional step]**.
#. Select :ref:`Hub <hub>` in the scene.

How To Use
""""""""""""""

You read more :ref:`here <roadEntitySubscene>`.

Settings
""""""""""""""

| **Entity subscene save path** : save path of :ref:`subscene <subscene>`.
| **Entity subscene name** : name of :ref:`subscene <subscene>`.
| **Autosync configs** : on/off auto-sync config on :ref:`main scene <mainScene>` & :ref:`subscene <subscene>`.
| **Move tools** : on/off moving of following tools: :ref:`PedestrianNode Creator <pedestrianNodeCreator>`, :ref:`RoadSegmentPlacer <roadSegmentPlacer>`.
| **Move lights** : on/off moving of :ref:`subscene <trafficLightObject>`.
| **Move props** : on/off moving of :ref:`props <propsInfo>`.
| **Move surface** : on/off moving of the selected physics surface.
| **Copy physics shapes** : on/off feature of physics shape :ref:`cloning <physicsShapeTransfer>`.

Config
""""""""""""""

| **Copy to subscene** : :ref:`subscene <subscene>` configs will be synchronised with the :ref:`main scene <mainScene>`.
| **Copy from subscene** : :ref:`main scene <mainScene>` configs will be synchronised with the :ref:`subscene <subscene>`.

Buttons
""""""""""""""

| **Generate** : generates :ref:`subscene <subscene>`.
| **Move back** : move road from :ref:`subscene <subscene>` to the :ref:`main scene <mainScene>` (can be useful for editing roads in the :ref:`main scene <mainScene>` due to `Editor` performance).

PedestrianNode Transfer Service
~~~~~~~~~~~~

Tool for cloning :ref:`Pedestrian nodes <pedestrianNode>` that are part of the prefab from the :ref:`main scene <mainScene>` to the :ref:`subscene <subscene>` .

	.. image:: /images/road/installation/PedestrianNodeTransferService.png
	
	.. note:: For example, can be useful to separate the `Building prefab` asset and its attached :ref:`Pedestrian nodes <pedestrianNode>`.
	
How To Use
""""""""""""""

Automatically used by :ref:`Entity Subscene Generator <subsceneGenerator>`.

.. _physicsShapeTransfer:

PhysicsShape Transfer Service
~~~~~~~~~~~~

* This tool only works for `DOTS` if the `DOTS` simulation type is selected in the :ref:`General Settings <generalSettingsConfig>`.
* Tool for cloning physical shapes from the :ref:`main scene <mainScene>` to the :ref:`subscene <subscene>`. 
* There is also a tool exists to maintain both the `default physical world <https://docs.unity3d.com/2022.2/Documentation/Manual/PhysicsOverview.html>`_ and the `DOTS physical world <https://docs.unity3d.com/2022.2/Documentation/Manual/PhysicsOverview.html>`_ at the same time, so that `default colliders <https://docs.unity3d.com/ScriptReference/Collider.html>`_ and `DOTS colliders <https://docs.unity3d.com/Packages/com.unity.physics@1.0/manual/custom-shapes.html>`_ exist at the same time if you need to use `default colliders <https://docs.unity3d.com/ScriptReference/Collider.html>`_ in `MonoBehaviour <https://docs.unity3d.com/ScriptReference/MonoBehaviour.html>`_  classes.

Current project use cases:
	* Keep `default colliders <https://docs.unity3d.com/ScriptReference/Collider.html>`_ to work with :ref:`Legacy ragdoll <pedestrianRagdoll>`.
	* Cloning of physical shapes from the :ref:`main scene <mainScene>` to be split them into subscene pieces by using :ref:`SubSceneChunk Creator <subSceneCreator>` or cloned into the :ref:`main subscene <subscene>` by using :ref:`Entity Subscene Generator <subsceneGenerator>`.

	.. note:: The tool can only use one tool at a time, either an :ref:`Entity Subscene Generator <subsceneGenerator>` or a :ref:`SubSceneChunk Creator <subSceneCreator>`.

Settings
""""""""""""""

	.. image:: /images/road/installation/PhysicsShapeTransferService.png

| **Clean components** : removes all components from the physics shape.
| **Clean childs** : removes all childs from the physics shape.
| **Search type** : searching shapes by layer or tag.

**Proccesing type** : 
	* **Stay previous** : cloning found `PhysicsShape <https://docs.unity3d.com/Packages/com.unity.physics@1.0/manual/custom-samples-physics-components.html>`_ or `Collider <https://docs.unity3d.com/ScriptReference/Collider.html>`_ to :ref:`subscene <subscene>`, useful to keep `default collider <https://docs.unity3d.com/ScriptReference/Collider.html>`_ and `Unity.Physics collider <https://docs.unity3d.com/Packages/com.unity.physics@1.0/manual/custom-samples-physics-components.html>`_ running at the same time.
	* **Disable collider** : cloning found `PhysicsShape <https://docs.unity3d.com/Packages/com.unity.physics@1.0/manual/custom-samples-physics-components.html>`_ or `Collider <https://docs.unity3d.com/ScriptReference/Collider.html>`_ to :ref:`subscene <subscene>` and disable it in the main scene.

**Preinit layer** : enable :ref:`pre-init <extendedStateList>` cull state for physics objects.

| **New layer** : assigns new layer for cloned shape.